/*
 * Analog.cpp
 *
 *  Created on: May 14, 2024
 *      Author: This PC
 */

#include "Analog.h"

namespace blib
{
    Analog::Analog() : mHadc(&hadc1), mHdmaAdc(&hdma_adc1)
    {
        sampling();
    }

    Analog::~Analog()
    {
        HAL_ADC_Stop_DMA(mHadc);
    }

    // Lay mau ADC bang DMA
    void Analog::sampling()
    {
        HAL_ADC_Start_DMA(mHadc, mAdcValues, NUMBER_OF_CHANNELS);
    }

    double Analog::getVin() const
    {
        return mVin;
    }
    double Analog::getIin() const
    {
        return mIin;
    }
    double Analog::getVout() const
    {
        return mVout;
    }
    double Analog::getIout() const
    {
        return mIout;
    }
    double Analog::getTemp() const
    {
        return mTemp;
    }

    void Analog::readAnalog()
    {
        mVin = convertAdcChannel1(mAdcValues[0]);
        mIin = convertAdcChannel2(mAdcValues[1]);
        mVout = convertAdcChannel3(mAdcValues[2]);
        mIout = convertAdcChannel4(mAdcValues[3]);
        mTemp = convertAdcChannel5(mAdcValues[4]);
    }

    double convertAdcChannel1(uint32_t adcValue);    // Convert adcValue -> Vin
    double convertAdcChannel2(uint32_t adcValue);    // Convert adcValue -> Iin
    double convertAdcChannel3(uint32_t adcValue);    // Convert adcValue -> Vout
    double convertAdcChannel4(uint32_t adcValue);    // Convert adcValue -> Iout
    double convertAdcChannel5(uint32_t adcValue);    // Convert adcValue -> Temperature
}    // namespace blib

